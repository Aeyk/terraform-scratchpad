apiVersion: v1
data:
  keycloak.conf: |
    # Basic settings for running in production. Change accordingly before deploying the server.
    # Database
    db=postgres
    db-username=postgres           # TODO fix permission to run as keycloak
    db-password=$POSTGRES_PASSWORD # TODO fix permission to run as keycloak
    db-url-host=postgres-cluster.default.svc.cluster.local
    # db-url=jdbc:postgresql://postgres-cluster.default.svc.cluster.local/keycloak

    http-max-queued-requests=10

    # Observability
    # If the server should expose healthcheck endpoints.
    #health-enabled=true
    # If the server should expose metrics endpoints.
    #metrics-enabled=true

    # HTTP
    # The file path to a server certificate or certificate chain in PEM format.
    #https-certificate-file=\${kc.home.dir}conf/server.crt.pem
    # The file path to a private key in PEM format.
    #https-certificate-key-file=\${kc.home.dir}conf/server.key.pem
    # The proxy address forwarding mode if the server is behind a reverse proxy.
    #proxy=reencrypt

    # Do not attach route to cookies and rely on the session affinity capabilities from reverse proxy
    #spi-sticky-session-encoder-infinispan-should-attach-route=false

    # Hostname for the Keycloak server.
    # hostname=keycloak.mksybr.com
    # hostname-path=/keycloak
    # http-relative-path=/keycloak
    hostname-url=https://keycloak.mksybr.com:443/keycloak
    hostname-admin-url=https://keycloak.mksybr.com:443/keycloak
    proxy=edge

    quarkus.transaction-manager.enable-recovery=true

kind: ConfigMap
metadata:
  name: keycloak-config
  namespace: keycloak
